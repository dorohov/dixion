"use strict";!function(){var t,i="azbn.",a={set:function(t,a){localStorage.setItem(i+t,a)},get:function(t){var a=localStorage.getItem(i+t);return"undefined"!=typeof a&&null!=a?a:null},remove:function(t){localStorage.removeItem(i+t)},clear:function(){localStorage.clear()},obj2s:function(t,i){this.set(t,JSON.stringify(i))},s2obj:function(t){var i=this.get(t);return"undefined"!=typeof i&&null!=i?JSON.parse(i):null}},e={prefix:"dixion.cart.",lscart_uid:function(){return this.prefix+"services"},set:function(t,i){var e=a.s2obj(this.lscart_uid());t.material=0,t.size=0,t.color=0,null!=e||(e={}),e[t.id]||(e[t.id]={}),e[t.id][t.material]||(e[t.id][t.material]={}),e[t.id][t.material][t.size]||(e[t.id][t.material][t.size]={}),e[t.id][t.material][t.size][t.color]={id:t.id,title:t.title,qty:i,cost1:t.cost1?parseFloat(""+t.cost1):e[t.id][t.material][t.size][t.color].cost1,cost2:t.cost2?parseFloat(""+t.cost2):""},a.obj2s(this.lscart_uid(),e)},getQty:function(t){var i=a.s2obj(this.lscart_uid());t.material=0,t.size=0,t.color=0,null!=i||(i={});var e=0;return e=i[t.id]&&i[t.id][t.material]&&i[t.id][t.material][t.size]&&i[t.id][t.material][t.size][t.color]?i[t.id][t.material][t.size][t.color].qty:e,parseInt(e)},getAll:function(){var t=a.s2obj(this.lscart_uid());null!=t||(t={});var i=0,e=0;for(var r in t)!function(t){for(var a in t)!function(t){for(var a in t)!function(t){for(var a in t)i+=t[a].qty,e+=t[a].qty*t[a].cost}(t[a])}(t[a])}(t[r]);return{qty:i,sum:e}},iterAll:function(t,i){var e=a.s2obj(this.lscart_uid());null!=e||(e={});var r=0,n=0;for(var o in e)!function(i){for(var a in i)!function(i){for(var a in i)!function(i){for(var a in i)n+=i[a].qty,r+=i[a].qty*i[a].cost1,t({id:o,title:i[a].title,qty:i[a].qty,cost1:i[a].cost1,cost2:i[a].cost2})}(i[a])}(i[a])}(e[o]);i(r,n)},del:function(t){var i=a.s2obj(this.lscart_uid());t.material=0,t.size=0,t.color=0,null!=i||(i={}),i[t.id]&&i[t.id][t.material]&&i[t.id][t.material][t.size]&&i[t.id][t.material][t.size][t.color]&&(i[t.id][t.material][t.size][t.color]=null,delete i[t.id][t.material][t.size][t.color],a.obj2s(this.lscart_uid(),i))},clear:function(){a.obj2s(this.lscart_uid(),{})}},r=function(i){var a=t.clone(!0);return a.attr("data-service-id",i.id).attr("data-service-cost1",i.cost1).attr("data-service-cost2",i.cost2),a.find(".azbn__incart-item__title").html(i.title),a.find(".azbn__incart-item__cost1").html(i.cost1),a.find(".azbn__incart-item__cost2").html(i.cost2?"/ "+i.cost2:""),a};$(function(){var i=$(".price-list-page");if(i.length){var a=$(".azbn__incart-items");t=a.find(".azbn__incart-item_ideal"),t.length&&($(document.body).on("azbn.cart.recalc",null,{},function(t){var i=[""];e.iterAll(function(t){r(t).appendTo(a),i.push(t.id+") "+t.title+". Первичный: "+t.cost1+" руб. Вторичный: "+t.cost2),$('.azbn__service-item[data-service-id="'+t.id+'"]').each(function(t){var i=$(this).find(".btn-basket.azbn__service-item__add");i.addClass("is--active"),i.find("svg").removeClass("icon-basket-add").addClass("icon-basket-active");var a=i.find("svg use").attr("xlink:href");a=a.split("#"),a=a[0],i.find("svg use").attr("xlink:href",a+"#basket-active")})},function(t,a){$(".azbn__incart-sum").html(t),$(".azbn__incart-qty").html(a),$(".azbn__incart-list").val(i.join("\n"))})}),$(document.body).on("click.azbn",".azbn__service-item__add",{},function(t){var i=$(this),r=i.closest(".azbn__service-item"),n=parseInt(r.attr("data-service-id"));e.set({id:n,title:r.attr("data-service-title"),cost1:parseFloat(r.attr("data-service-cost1")),cost2:r.attr("data-service-cost2")||""},1),a.empty(),$(document.body).trigger("azbn.cart.recalc")}),$(document.body).on("click.azbn",".azbn__incart-item__delete",{},function(t){var i=$(this),r=i.closest(".azbn__incart-item"),n=parseInt(r.attr("data-service-id"));e.del({id:n}),a.empty(),$(document.body).trigger("azbn.cart.recalc")}),t.detach(),a.empty(),$(document.body).trigger("azbn.cart.recalc"))}$(document.body).on("submit",".azbn-api-formsave",{},function(t){t.preventDefault();var i=$(this),a=i.clone(!0),r=i.attr("data-method")||"formsave";a.append($("<input/>",{type:"hidden",name:"method",value:r})),$.post("/api/",a.serialize(),function(t){t=JSON.parse(t),a.empty().remove(),i.trigger("reset"),i.closest(".modal").modal("hide"),$(".azbn-api-formsave-result").html(t.response.message.text),$("#modal-message-formsave-result").modal(),i.hasClass("_azbn-service-order-form")&&e.clear()})}),$(document.body).on("click",".azbn-specialist-order-btn",{},function(t){var i=$(this),a=i.attr("data-specialist-name")||"";$("#modal-appointment input.azbn-form-editable").val(a)}),$(document.body).on("click",".azbn-service-program-order-btn",{},function(t){var i=$(this),a=i.attr("data-service-program")||"";$("#modal-order input.azbn-form-editable").val(a)}),$(document.body).on("click","svg polygon.azbn-tour-polygon",{},function(t){var i=$(this),a=i.attr("data-room-preview")||"",e=i.attr("data-room-name")||"";$(".azbn-tour-image").css({"background-image":"url("+a+")"}),$(".azbn-tour-title").html(e),$("svg polygon.azbn-tour-polygon").removeClass("is--active"),i.addClass("is--active")}),$("svg polygon.azbn-tour-polygon").eq(0).trigger("click"),$(".schedule-page .price-list-block__item-list .price-list-block__item-link").eq(0).trigger("click")})}();